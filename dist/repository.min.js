(function(){"use strict";function t(t,r){var s={seen:[],stylize:n};return arguments.length>=3&&(s.depth=arguments[2]),arguments.length>=4&&(s.colors=arguments[3]),l(r)?s.showHidden=r:r&&M._extend(s,r),v(s.showHidden)&&(s.showHidden=!1),v(s.depth)&&(s.depth=2),v(s.colors)&&(s.colors=!1),v(s.customInspect)&&(s.customInspect=!0),s.colors&&(s.stylize=e),i(s,t,s.depth)}function e(e,n){var r=t.styles[n];return r?"["+t.colors[r][0]+"m"+e+"["+t.colors[r][1]+"m":e}function n(t,e){return t}function r(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}function i(t,e,n){if(t.customInspect&&e&&b(e.inspect)&&e.inspect!==M.inspect&&(!e.constructor||e.constructor.prototype!==e)){var f=e.inspect(n,t);return g(f)||(f=i(t,f,n)),f}var p=s(t,e);if(p)return p;var m=Object.keys(e),v=r(m);t.showHidden&&(m=Object.getOwnPropertyNames(e));var _,S=e;try{P(e)||(S=e.valueOf())}catch(w){}if(g(S)&&(m=m.filter(function(t){return!(t>=0&&t<S.length)})),0===m.length){if(b(e)){var O=e.name?": "+e.name:"";return t.stylize("[Function"+O+"]","special")}if(y(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(P(e))return t.stylize(Date.prototype.toString.call(e),"date");if(E(e))return a(e);if(g(S))return _=o(t,S),t.stylize("[String: "+_+"]","string");if(d(S))return _=o(t,S),t.stylize("[Number: "+_+"]","number");if(l(S))return _=o(t,S),t.stylize("[Boolean: "+_+"]","boolean")}var N="",x=!1,L=["{","}"];if(Y(e)&&(x=!0,L=["[","]"]),b(e)){var I=e.name?": "+e.name:"";N=" [Function"+I+"]"}if(y(e)&&(N=" "+RegExp.prototype.toString.call(e)),P(e)&&(N=" "+Date.prototype.toUTCString.call(e)),E(e)&&(N=" "+a(e)),g(S)&&(_=o(t,S),N=" [String: "+_+"]"),d(S)&&(_=o(t,S),N=" [Number: "+_+"]"),l(S)&&(_=o(t,S),N=" [Boolean: "+_+"]"),0===m.length&&(!x||0===e.length))return L[0]+N+L[1];if(0>n)return y(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var T;return T=x?u(t,e,n,v,m):m.map(function(r){return h(t,e,n,v,r,x)}),t.seen.pop(),c(T,N,L)}function s(t,e){if(v(e))return t.stylize("undefined","undefined");if(g(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return d(e)?0===e&&0>1/e?t.stylize("-0","number"):t.stylize(""+e,"number"):l(e)?t.stylize(""+e,"boolean"):f(e)?t.stylize("null","null"):m(e)?t.stylize(e.toString(),"symbol"):void 0}function o(t,e){var r=t.stylize;t.stylize=n;var i=s(t,e);return t.stylize=r,i}function a(t){return"["+Error.prototype.toString.call(t)+"]"}function u(t,e,n,r,i){for(var s=[],o=0,a=e.length;a>o;++o)L(e,String(o))?s.push(h(t,e,n,r,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(h(t,e,n,r,i,!0))}),s}function h(t,e,n,r,s,o){var a,u,h;if(h=Object.getOwnPropertyDescriptor(e,s)||{value:e[s]},h.get?u=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(u=t.stylize("[Setter]","special")),L(r,s)||(a="["+s+"]"),u||(t.seen.indexOf(h.value)<0?(u=f(n)?i(t,h.value,null):i(t,h.value,n-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+u.split("\n").map(function(t){return"   "+t}).join("\n"))):u=t.stylize("[Circular]","special")),v(a)){if(o&&s.match(/^\d+$/))return u;a=JSON.stringify(""+s),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'").replace(/\\\\/g,"\\"),a=t.stylize(a,"string"))}return a+": "+u}function c(t,e,n){var r=t.reduce(function(t,e){return t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return r>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}function l(t){return"boolean"==typeof t}function f(t){return null===t}function p(t){return null==t}function d(t){return"number"==typeof t}function g(t){return"string"==typeof t}function m(t){return"symbol"==typeof t}function v(t){return void 0===t}function y(t){return _(t)&&"[object RegExp]"===O(t)}function _(t){return"object"==typeof t&&null!==t}function P(t){return _(t)&&"[object Date]"===O(t)}function E(t){return _(t)&&("[object Error]"===O(t)||t instanceof Error)}function b(t){return"function"==typeof t}function S(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function w(t){return t instanceof Buffer}function O(t){return Object.prototype.toString.call(t)}function N(t){return 10>t?"0"+t.toString(10):t.toString(10)}function x(){var t=new Date,e=[N(t.getHours()),N(t.getMinutes()),N(t.getSeconds())].join(":");return[t.getDate(),G[t.getMonth()],e].join(" ")}function L(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function I(){I.init.call(this)}function T(t){if(I.call(this),t instanceof R==!1)throw new Error("Invalid config");if(!t.dataProvider)throw new Error("You must specify a data provider");this.contexts={},this.config=t,this.dataProvider=this.config.dataProvider,this.name=this.config.name}function D(){I.call(this),this._filters=[],this.operatorsArray=Object.keys(this.operators).map(function(t){return this.operators[t]},this)}function A(t){I.call(this),this._filter=new D,this._sorting=new z,this._pagination=new j,this.resourceName=t||null}function j(){I.call(this),this.reset()}function z(){I.call(this),this._sorting=[]}function U(){I.call(this),this._pauseEvents=!1,this._queue=[]}function F(t){I.call(this);var e=this.createQuery();return this.name=t,this.data=null,this.error=null,this.query=e,e.on("update",function(t){this.emit("update")}.bind(this)),this}function C(){function t(){this.emit("update")}A.call(this);var e=t.bind(this);this._filter.on("update",e),this._sorting.on("update",e),this._pagination.on("update",e)}function J(){I.call(this)}function R(t){if(!t.name)throw new Error("Invalid resource name");if(t.dataProvider instanceof J==!1)throw new Error("Invalid data provider");M.extend(this,t)}var M={},V={noDeprecation:!0,env:{NODE_DEBUG:1}},q={process:V};M.isFloat=function(t){return t===Number(t)&&t%1!==0},M.missing=function(t){return function(){throw new Error("Method "+t+" not implemented")}},M.toArray=function(t){return Array.prototype.slice.apply(t)};var B=/%[sdj%]/g;M.format=function(e){if(!g(e)){for(var n=[],r=0;r<arguments.length;r++)n.push(t(arguments[r]));return n.join(" ")}for(var r=1,i=arguments,s=i.length,o=String(e).replace(B,function(t){if("%%"===t)return"%";if(r>=s)return t;switch(t){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(e){return"[Circular]"}default:return t}}),a=i[r];s>r;a=i[++r])o+=f(a)||!_(a)?" "+a:" "+t(a);return o},M.deprecate=function(t,e){function n(){if(!r){if(V.throwDeprecation)throw new Error(e);V.traceDeprecation?console.trace(e):console.error(e),r=!0}return t.apply(this,arguments)}if(v(q.process))return function(){return M.deprecate(t,e).apply(this,arguments)};if(V.noDeprecation===!0)return t;var r=!1;return n};var Q,k={};M.debuglog=function(t){if(v(Q)&&(Q=V.env.NODE_DEBUG||""),t=t.toUpperCase(),!k[t])if(new RegExp("\\b"+t+"\\b","i").test(Q)){var e=V.pid;k[t]=function(){var n=M.format.apply(M,arguments);console.error("%s %d: %s",t,e,n)}}else k[t]=function(){};return k[t]},M.inspect=t,t.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},t.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",symbol:"green",date:"magenta",regexp:"red"};var Y=M.isArray=Array.isArray;M.isBoolean=l,M.isNull=f,M.isNullOrUndefined=p,M.isNumber=d,M.isString=g,M.isSymbol=m,M.isUndefined=v,M.isRegExp=y,M.isObject=_,M.isDate=P,M.isError=E,M.isFunction=b,M.isPrimitive=S,M.isBuffer=w;var G=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];M.log=function(){console.log("%s - %s",x(),M.format.apply(M,arguments))},M.inherits=function(t,e,n){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_(n)&&M.extend(t.prototype,n)},M._extend=function(t,e){if(!e||!_(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t},M.extend=M._extend,M.p=M.deprecate(function(){for(var t=0,e=arguments.length;e>t;++t)console.error(M.inspect(arguments[t]))},"util.p: Use console.error() instead"),M.print=M.deprecate(function(){for(var t=0,e=arguments.length;e>t;++t)V.stdout.write(String(arguments[t]))},"util.print: Use console.log instead"),M.puts=M.deprecate(function(){for(var t=0,e=arguments.length;e>t;++t)V.stdout.write(arguments[t]+"\n")},"util.puts: Use console.log instead"),M.debug=M.deprecate(function(t){V.stderr.write("DEBUG: "+t+"\n")},"util.debug: Use console.error instead"),M.error=M.deprecate(function(t){for(var e=0,n=arguments.length;n>e;++e)V.stderr.write(arguments[e]+"\n")},"util.error: Use console.error instead"),M.pump=M.deprecate(function(t,e,n){function r(t,e,r){n&&!i&&(n(t,e,r),i=!0)}var i=!1;t.addListener("data",function(n){e.write(n)===!1&&t.pause()}),e.addListener("drain",function(){t.resume()}),t.addListener("end",function(){e.end()}),t.addListener("close",function(){r()}),t.addListener("error",function(t){e.end(),r(t)}),e.addListener("error",function(e){t.destroy(),r(e)})},"util.pump(): Use readableStream.pipe() instead");var $;M._errnoException=function(t,e,n){v($)&&($=V.binding("uv"));var r=$.errname(t),i=e+" "+r;n&&(i+=" "+n);var s=new Error(i);return s.code=r,s.errno=r,s.syscall=e,s},I.EventEmitter=I,I.usingDomains=!1,I.prototype.domain=void 0,I.prototype._events=void 0,I.prototype._maxListeners=void 0,I.defaultMaxListeners=10,I.init=function(){this.domain=null,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events={}),this._maxListeners=this._maxListeners||void 0},I.prototype.setMaxListeners=function(t){if(!M.isNumber(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},I.prototype.emit=function(t){var e,n,r,i,s,o;if(this._events||(this._events={}),"error"===t&&!this._events.error){if(e=arguments[1],!this.domain)throw e instanceof Error?e:Error('Uncaught, unspecified "error" event.');return e||(e=new Error('Uncaught, unspecified "error" event.')),e.domainEmitter=this,e.domain=this.domain,e.domainThrown=!1,this.domain.emit("error",e),!1}if(n=this._events[t],M.isUndefined(n))return!1;if(this.domain&&this!==V&&this.domain.enter(),M.isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,i=new Array(r-1),s=1;r>s;s++)i[s-1]=arguments[s];n.apply(this,i)}else if(M.isObject(n)){for(r=arguments.length,i=new Array(r-1),s=1;r>s;s++)i[s-1]=arguments[s];for(o=n.slice(),r=o.length,s=0;r>s;s++)o[s].apply(this,i)}return this.domain&&this!==V&&this.domain.exit(),!0},I.prototype.addListener=function(t,e){var n;if(!M.isFunction(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,M.isFunction(e.listener)?e.listener:e),this._events[t]?M.isObject(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,M.isObject(this._events[t])&&!this._events[t].warned){var n;n=M.isUndefined(this._maxListeners)?I.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d %s listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length,t),console.trace())}return this},I.prototype.on=I.prototype.addListener,I.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!M.isFunction(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},I.prototype.removeListener=function(t,e){var n,r,i,s;if(!M.isFunction(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],i=n.length,r=-1,n===e||M.isFunction(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(M.isObject(n)){for(s=i;s-->0;)if(n[s]===e||n[s].listener&&n[s].listener===e){r=s;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},I.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],M.isFunction(n))this.removeListener(t,n);else if(Array.isArray(n))for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},I.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?M.isFunction(this._events[t])?[this._events[t]]:this._events[t].slice():[]},I.listenerCount=function(t,e){var n;return n=t._events&&t._events[e]?M.isFunction(t._events[e])?1:t._events[e].length:0},M.inherits(T,I,{hasContext:function(t){return this.contexts[t]instanceof F},createContext:function(t){if(!this.hasContext(t)){var e=new F(t);e.on("update",function(){this.updateContext(e)}.bind(this)),this.contexts[t]=e}return this.getContext(t)},getContext:function(t){return this.contexts[t]},updateContext:function(t){var e=t.toJSON();return this.dataProvider.find(this.name,e).then(function(e){t.setData(e)},function(e){t.setError(e)}),this},removeContext:function(t){return delete this.contexts[t],this},find:function(t){if(t instanceof A==!1)throw new Error("Invalid query builder");var e=t.toJSON();return this.dataProvider.find(this.name,e)},findOne:function(t){return this.dataProvider.findOne(this.name,t)},removeOne:function(t){return this.dataProvider.removeOne(this.name,t)},remove:function(t){return this.dataProvider.remove(this.name,t)},saveOne:function(t){var e=this;return this.dataProvider.saveOne(this.name,t).then(function(t){return e.emit(e.EVENTS.UPDATE),t})},save:function(t){if(0===t.length)return this.dataProvider.error(this.ERRORS.EMPTY_ENTITY_SET);var e=this;return this.dataProvider.save(this.name,t).then(function(t){return e.emit(e.EVENTS.UPDATE),t})},EVENTS:{UPDATE:"update"},ERRORS:{EMPTY_ENTITY_SET:"EMPTY_ENTITY_SET",INVALID_ENTITY_SET:"INVALID_ENTITY_SET"}}),D.create=function(t){var e=new D;return e.setState(t),e},M.inherits(D,I,{reset:function(){this._filters=[]},where:function(t,e,n){return 2===arguments.length&&(n=e,e=this.operators.EQ),this.hasOperator(e)?(this.addFilter(t,e,n),this):this},hasOperator:function(t){return this.operatorsArray.indexOf(t)>-1},remove:function(t){return t?(this._filters.forEach(function(e,n){e.name===t&&this._filters.splice(n,1)},this),this):this},addFilter:function(){var t,e=M.toArray(arguments);if(M.isArray(e[0])&&(e=e[0]),M.isObject(e[0])&&(t=e[0]),M.isUndefined(t)&&(t={name:e[0],operator:e[1],value:e[2]}),!t)return this;var n=this._filters.some(function(e){return e.name===t.name&&e.operator===t.operator});return n?this:(this._filters.push(t),this)},addFilters:function(t){if(!M.isArray(t))throw new Error("Must be an array");return t.forEach(this.addFilter,this),this},operators:{EQ:"=",LT:"<",LTE:"<=",GT:">",GTE:">=",IN:"in",ST:"^",END:"$",LK:"~"},setState:function(){return this.addFilter.apply(this,arguments)},toJSON:function(){return this._filters.slice()}}),M.inherits(A,I,{from:function(t){return this.resourceName=t,this},where:function(){return this._filter.where.apply(this._filter,arguments),this},orderBy:function(){return this._sorting.sort.apply(this._sorting,arguments),this},pagination:function(){return this._pagination},limit:function(t){return this.pagination().setState({itemsPerPage:t}),this},toJSON:function(){return{filters:this._filter.toJSON(),pagination:this._pagination.toJSON(),sorting:this._sorting.toJSON()}},reset:function(){return this._filter.reset(),this._sorting.reset(),this._pagination.reset(),this}}),M.extend(A,D.prototype.operators),M.inherits(j,I,{isValidPage:function(t){return t>0&&t<=this.totalPages},next:function(){return this.isValidPage(this.currentPage+1)?(this.setPage(this.currentPage+1),this):this},previous:function(){return this.isValidPage(this.currentPage-1)?(this.setPage(this.currentPage-1),this):this},setPage:function(t){this.currentPage;return this.currentPage=t,this.emit("update"),this},setItemsPerPage:function(t){return this.setState({itemsPerPage:t}),this.refresh(),this},setState:function(t){var e=t.totalItems;if(0!==e&&!M.isUndefined(e)&&isNaN(e))throw new Error("Invalid total items property");return angular.extend(this,t),this.refresh(),this},refresh:function(){(this.currentPage<1||!this.isValidPage(this.currentPage))&&(this.currentPage=this.defaults.currentPage),this.itemsPerPage<1&&(this.itemsPerPage=Math.floor(this.defaults.itemsPerPage)),this.totalItems=this.totalItems||0,this.itemsPerPage=parseInt(this.itemsPerPage),this.totalPages=this.totalItems/this.itemsPerPage,(!this.totalPages||M.isFloat(this.totalPages))&&(this.totalPages=Math.round(this.totalItems/this.itemsPerPage)),this._pages=[];for(var t=0;t<this.totalPages;t++)this._pages.push(t+1)},reset:function(){return this.setState({currentPage:0,itemsPerPage:0,totalItems:0,totalPages:0}),this},last:function(){return this.isValidPage(this.totalPages)?(this.setPage(this.totalPages),this):this},first:function(){return this.currentPage?this.setPage(1):this},toJSON:function(){var t={},e=["itemsPerPage","currentPage","count"];return angular.forEach(e,function(e){angular.isDefined(this[e])&&(t[e]=this[e])},this),t},defaults:{itemsPerPage:4,currentPage:1,totalItems:0}}),M.inherits(z,I,{directions:{ASC:"asc",DESC:"desc"},sort:function(t,e){1===arguments.length&&(e=this.directions.ASC);var n={name:t,direction:e};return this.addSorting(n),this},hasSorting:function(t){return this._sorting.some(function(e){return e.name===t})},addSorting:function(t){return this.hasSorting(t.name)||this._sorting.push(t),this},reset:function(){return this._sorting=[],this},toJSON:function(){return this._sorting.slice()}}),M.inherits(U,I,{pause:function(){return this._pauseEvents=!0,this},resume:function(){return this._pauseEvents=!1,this.finish(),this},isPaused:function(){return this._pauseEvents},schedule:function(){var t=M.toArray(arguments);return this._queue.push(t),this},finish:function(){return this._queue.forEach(function(t,e){this.emit.apply(this,t)},this),this._queue.splice(0,this._queue.length),this},emit:function(){return this.isPaused()?this.schedule.apply(this,arguments):I.prototype.emit.apply(this,arguments)}}),F.createQuery=function(){return new C},M.inherits(F,U,{INVALID_RESPONSE:"INVALID_RESPONSE",getData:function(){return this.data},setData:function(t){if(M.isUndefined(t)||!M.isObject(t))return this.setError(this.INVALID_RESPONSE),this;var e=t.meta;if(e){var n=this.query.pagination();n.setState({totalItems:e.totalItems,currentPage:e.currentPage,itemsPerPage:e.itemsPerPage})}return this.data=t.data||null,this.error=null,this},createQuery:function(){return F.createQuery().from(this.name)},pagination:function(){return this.query.pagination()},reset:function(){return this.query.reset(),this},update:function(){return this.triggerUpdate(this),this},triggerUpdate:function(){return this.emit("update")},setError:function(t){},toJSON:function(){return this.query.toJSON()}}),M.inherits(C,A,{}),M.inherits(J,I,{find:M.missing("find"),findOne:M.missing("find")});var H={Repository:T,DataProvider:J,RepositoryConfig:R,QueryBuilder:A,QueryFilter:D,QueryPagination:j,QuerySorting:z,Context:F,ContextQueryBuilder:C,ContextEventEmitter:U,util:M,EventEmitter:I};!function(t,e){"function"==typeof define&&define.amd?define(["repository"],function(n){return t.amdWebGlobal=e(n)}):e(t)}(this,function(t){t.repository=H})}).call(this);